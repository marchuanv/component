function Factory(){const a={};Object.defineProperty(this,"createContainer",{configurable:!1,writable:!1,value:({scopeId:e,type:n,variableName:o,singleton:r})=>{r=r?"global":e;if(!r)throw new Error("Factory: no scopeId provided.");a[r]||(a[r]=[]);const t=a[r],c={references:{},Id:utils.generateGUID(),type:n,name:o,scopeId:r,config:e=>{var r=e.references||e;for(const n of Object.keys(r))c.references[n]=r[n]},ensureInstance:()=>{if(c.references[o])return c.references[o];const e={scopeId:c.scopeId};for(const r of Object.keys(c.references))e[r]=c.references[r];c.references[o]=new n(e)}};return t.push(c),c}}),Object.defineProperty(this,"getContainer",{configurable:!1,writable:!1,value:({scopeId:e,type:r,variableName:n,singleton:o})=>{o=o?"global":e;if(o)return a[o]?a[o].find(e=>e.name===n&&e.type.name===r.name):null;throw new Error("Factory: no scopeId provided.")}})}Factory.prototype.createContainer=function(e){};;
function ClientMessageBus({httpClientRequestMessageBus:s,httpClientResponseMessageBus:e,messageConverter:t}){Object.defineProperty(this,"publish",{configurable:!1,writable:!1,value:async({message:e})=>{await s.publish(t.convertMessageToHttpRequestMessage({message:e}))}}),Object.defineProperty(this,"subscribe",{configurable:!1,writable:!1,value:({callback:s})=>{e.subscribe({callback:async({httpResponseMessage:e})=>{await s(t.convertHttpResponseMessageToMessage({httpResponseMessage:e}))}})}})}ClientMessageBus.prototype.publish=async function({}){},ClientMessageBus.prototype.subscribe=function({}){};function Component({scopeId:r,clientMessageBus:n,serverMessageBus:a,userSessions:i,packageJson:e}){const{senderHost:o,senderPort:c,recipientHost:u,recipientPort:l,userId:p,timeout:d,isServerComponent:b}=e;Object.defineProperty(this,"initialise",{configurable:!1,writable:!1,value:async({secret:e})=>{const t=i.ensureSession({userId:p})["userSecurity"],s=(t.register({secret:e}),t.authenticate({secret:e}))["token"];b?(createHttpServerMessageBus({scopeId:r,timeout:d,senderHost:o,senderPort:c}),createHttpServerMessageBusManager({scopeId:r}),Object.defineProperty(this,"receive",{configurable:!1,writable:!1,value:async({callback:e})=>{await a.subscribe({callback:e})}}),Object.defineProperty(this,"send",{configurable:!1,writable:!1,value:async e=>{await a.publish(createMessage({scopeId:utils.generateGUID(),messageStatusCode:0,Id:null,data:e,recipientHost:u,recipientPort:l,metadata:{},token:s,senderHost:o,senderPort:c}))}})):(createHttpClientMessageBus({scopeId:r,timeout:d}),createHttpClientMessageBusManager({scopeId:r}),Object.defineProperty(this,"receive",{configurable:!1,writable:!1,value:async({callback:e})=>{await n.subscribe({callback:e})}}),Object.defineProperty(this,"send",{configurable:!1,writable:!1,value:async e=>{await n.publish(createMessage({scopeId:utils.generateGUID(),messageStatusCode:2,Id:null,data:e,recipientHost:u,recipientPort:l,metadata:{},token:s,senderHost:o,senderPort:c}))}}))}})}Component.prototype.initialise=async function({}){},Component.prototype.receive=async function({}){throw new Error("component was not initialised.")},Component.prototype.send=async function({}){throw new Error("component was not initialised.")};function ContentType({name:t}){var e=Object.values(types).findIndex(e=>e===t),e=0<Object.keys(types).findIndex(e=>e===t)?t:0<e?Object.keys(types)[e]:"unknown";Object.defineProperty(this,"name",{configurable:!1,writable:!1,value:e}),Object.defineProperty(this,"description",{configurable:!1,writable:!1,value:types[e]})}ContentType.prototype.name="",ContentType.prototype.description="";function Logger(){let l={},i=!1;Object.defineProperty(this,"log",{configurable:!1,writable:!1,value:({date:n,context:r,text:a})=>{return new Promise(e=>{const o=setInterval(()=>{if(!i){i=!0,l[r]||(l[r]=[]),l[r].push({date:n,text:a}),e(),l[r]=l[r].sort((t,e)=>new Date(t.date)-new Date(e.date));let t=l[r].shift();for(;t;){const{date:n,text:a}=t;console.log(n.toISOString()+`: ${r}, `+a),t=l[r].shift()}clearInterval(o),i=!1}},1e3)})}})}Logger.prototype.log=function({}){};function Message({scopeId:r,Id:e,messageContent:t,messageContentMetadata:a,messageMetadata:n,messageStatus:s}){const o=e||utils.generateGUID();Object.defineProperty(this,"getId",{configurable:!1,writable:!1,value:()=>o}),Object.defineProperty(this,"getSenderAddress",{configurable:!1,writable:!1,value:()=>{var{senderhost:e,senderport:t}=n;return createSenderAddress({scopeId:r,senderHost:e,senderPort:t})}}),Object.defineProperty(this,"getRecipientAddress",{configurable:!1,writable:!1,value:()=>{var{recipienthost:e,recipientport:t}=n;return createRecipientAddress({scopeId:r,recipientHost:e,recipientPort:t})}}),Object.defineProperty(this,"getEncryptedContent",{configurable:!1,writable:!1,value:()=>t.encryptedData}),Object.defineProperty(this,"getDecryptedContent",{configurable:!1,writable:!1,value:()=>t.decryptedData}),Object.defineProperty(this,"getMessageMetadata",{configurable:!1,writable:!1,value:()=>n}),Object.defineProperty(this,"getContentMetadata",{configurable:!1,writable:!1,value:()=>a}),Object.defineProperty(this,"getMessageStatus",{configurable:!1,writable:!1,value:()=>s.root()})}Message.prototype.getId=function(){},Message.prototype.getSenderAddress=function(){},Message.prototype.getRecipientAddress=function(){},Message.prototype.getEncryptedContent=function(){},Message.prototype.getDecryptedContent=function(){},Message.prototype.getMessageMetadata=function(){},Message.prototype.getContentMetadata=function(){},Message.prototype.getMessageStatus=function(){};function MessageContent({data:t,userSessions:n,messageMetadata:e,messageContentMetadata:s}){var e=e["token"],r=utils.getJSONObject(utils.base64ToString(e))["userId"];const a=n.ensureSession({userId:r})["userSecurity"];let o=null,c=null;if(a.isAuthorised({token:e})){var{contentType:n,isEncrypted:e}=s;if(e&&"base64Text"===n.name)o=a.decryptJSONToObject({encryptedJsonStr:t.replace("Encrypted:","")}),c=t;else{let e=null;"string"==typeof t&&"txt"===n.name&&(e={text:t}),c=a.encryptObjectToJSON({object:e}),o=a.decryptJSONToObject({encryptedJsonStr:c}),c="Encrypted:"+c,s.setContentType({name:"txt"}),s.setContentLength({length:Buffer.byteLength(c)})}}else o=`unable to decrypt message content, '${r}' user is not authorised.`,c=`unable to encrypt message content, '${r}' user is not authorised.`;Object.defineProperty(this,"encryptedData",{configurable:!1,writable:!1,value:c}),Object.defineProperty(this,"decryptedData",{configurable:!1,writable:!1,value:o})}MessageContent.prototype.encryptedData=function(){},MessageContent.prototype.decryptedData=function(){};function MessageContentMetadata({scopeId:t,data:e}){let n=!1,a=null,o=utils.getJSONObject(e)||e,r=("object"==typeof o?(a="json",o=utils.getJSONString(o)):"string"==typeof o&&(a="txt",n=e.startsWith("Encrypted:"),utils.isBase64String(e.replace("Encrypted:",""))&&(a="base64Text")),createContentType({scopeId:t,name:a}))["contentType"],s=Buffer.byteLength(o);Object.defineProperty(this,"contentType",{configurable:!1,get:()=>r}),Object.defineProperty(this,"contentLength",{configurable:!1,get:()=>s}),Object.defineProperty(this,"isEncrypted",{configurable:!1,writable:!1,value:n}),Object.defineProperty(this,"setContentLength",{configurable:!1,writable:!1,value:({length:e})=>s=e}),Object.defineProperty(this,"setContentType",{configurable:!1,writable:!1,value:({name:e})=>r=createContentType({scopeId:t,name:e})})}MessageContentMetadata.prototype.contentType="",MessageContentMetadata.prototype.contentLength=-1,MessageContentMetadata.prototype.isEncrypted="";function MessageConverter(){Object.defineProperty(this,"convertMessageToHttpRequestMessage",{configurable:!1,writable:!1,value:({message:e})=>{var t=e.getId(),s=e.getEncryptedContent(),{senderHost:r,senderPort:a}=e.getSenderAddress(),{recipientHost:n,recipientPort:o}=e.getRecipientAddress(),d=e.getMessageMetadata(),g=d["token"],e=e.getMessageStatus()["code"];return createHttpRequestMessage({scopeId:utils.generateGUID(),messageStatusCode:e,Id:t,data:s,recipientHost:n,recipientPort:o,metadata:d,token:g,senderHost:r,senderPort:a})}}),Object.defineProperty(this,"convertMessageToHttpResponseMessage",{configurable:!1,writable:!1,value:({message:e})=>{var t=e.getMessageStatus()["code"],s=e.getId(),r=e.getEncryptedContent(),{recipientHost:a,recipientPort:n}=e.getRecipientAddress(),o=e.getMessageMetadata(),d=o["token"],{senderHost:e,senderPort:g}=e.getSenderAddress();return createHttpResponseMessage({scopeId:utils.generateGUID(),messageStatusCode:t,Id:s,data:r,recipientHost:a,recipientPort:n,metadata:o,token:d,senderHost:e,senderPort:g})}}),Object.defineProperty(this,"convertHttpRequestMessageToMessage",{configurable:!1,writable:!1,value:({httpRequestMessage:e})=>{var t=e.getMessageStatus()["code"],s=e.getId(),r=e.getEncryptedContent(),{recipientHost:a,recipientPort:n}=e.getRecipientAddress(),o=e.getMessageMetadata(),d=o["token"],{senderHost:e,senderPort:g}=e.getSenderAddress();return createMessage({scopeId:utils.generateGUID(),messageStatusCode:t,Id:s,data:r,recipientHost:a,recipientPort:n,metadata:o,token:d,senderHost:e,senderPort:g})}}),Object.defineProperty(this,"convertHttpResponseMessageToMessage",{configurable:!1,writable:!1,value:({httpResponseMessage:e})=>{var t=e.getMessageStatus()["code"],s=e.getId(),r=e.getEncryptedContent(),{recipientHost:a,recipientPort:n}=e.getRecipientAddress(),o=e.getMessageMetadata(),d=o["token"],{senderHost:e,senderPort:g}=e.getSenderAddress();return createMessage({scopeId:utils.generateGUID(),messageStatusCode:t,Id:s,data:r,recipientHost:a,recipientPort:n,metadata:o,token:d,senderHost:e,senderPort:g})}})}MessageConverter.prototype.convertMessageToHttpRequestMessage=function({}){},MessageConverter.prototype.convertMessageToHttpResponseMessage=function({}){},MessageConverter.prototype.convertHttpRequestMessageToMessage=function({}){},MessageConverter.prototype.convertHttpResponseMessageToMessage=function({}){};function MessageMetadata({metadata:e,token:t,senderAddress:r,recipientAddress:a}){Object.defineProperty(this,"create",{configurable:!1,writable:!1,value:({name:t,value:e})=>{getProperties({object:this}).find(e=>e.propertyName===t)||Object.defineProperty(this,t,{configurable:!1,get:()=>isNaN(e)?e:Number(e)})}}),this.create({name:"token",value:t});for(const o of getProperties({object:e}))this.create({name:o.propertyName,value:o.propertyValue});for(const s of getProperties({object:r}))this.create({name:s.propertyName,value:s.propertyValue});for(const p of getProperties({object:a}))this.create({name:p.propertyName,value:p.propertyValue})}MessageMetadata.prototype.create=function({}){};function MessageQueue({logger:i}){const t={},g=async({binding:a})=>{if(0!==a.callbacks.length&&0!==a.messages.length)if(a.locked)log({logger:i,binding:a,text:"waiting for queue lock"}),setTimeout(()=>g({binding:a}),1e3);else{a.locked=!0;const s=a.callbacks.sort((e,a)=>e.priority-a.priority),n=s.shift();log({logger:i,binding:a,text:`pulling message (1 of ${a.messages.length})`});var e=a.messages.shift()["message"];try{await n.resolve({message:e})}catch(e){log({logger:i,binding:a,text:`callback error: ${e.message}.`})}a.locked=!1,g({binding:a})}},l=async({binding:a})=>{if(0!==a.peekCallbacks.length)if(a.locked)log({logger:i,binding:a,text:"waiting for queue lock"}),setTimeout(()=>l({binding:a}),1e3);else{a.locked=!0,log({logger:i,binding:a,text:`peeking at first message (1 of ${a.messages.length})`});var e=(a.messages[a.messages.length-1]||{message:null})["message"];try{const s=a.peekCallbacks.shift();await s.resolve({message:e})}catch(e){log({logger:i,binding:a,text:`callback error: ${e.message}.`})}a.locked=!1,l({binding:a})}};Object.defineProperty(this,"queueMessage",{configurable:!1,writable:!1,value:async({message:e,queueName:a})=>{var s=utils.generateGUID();const n=t[a];log({logger:i,binding:n,text:`pushing message (1 of ${n.messages.length})`}),n.messages.push({Id:s,queueName:a,message:e}),l({binding:n}),g({binding:n})}}),Object.defineProperty(this,"dequeueMessage",{configurable:!1,writable:!1,value:({queueName:i})=>new Promise(e=>{var a=utils.generateGUID();const s=t[i];var n=s.callbacks.length-1+1;s.callbacks.push({Id:a,queueName:i,resolve:e,priority:n}),g({binding:s})})}),Object.defineProperty(this,"peekMessage",{configurable:!1,writable:!1,value:({queueName:n})=>new Promise(e=>{var a=utils.generateGUID();const s=t[n];s.peekCallbacks.push({Id:a,queueName:n,resolve:e}),l({binding:s})})}),Object.defineProperty(this,"bind",{configurable:!1,writable:!1,value:({scopeId:e,bindingObj:a})=>{const s=e+"_"+a.constructor.name;Object.defineProperty(a,"name",{configurable:!1,writable:!1,value:s}),Object.defineProperty(a,"messages",{configurable:!1,writable:!1,value:[]}),Object.defineProperty(a,"callbacks",{configurable:!1,writable:!1,value:[]}),Object.defineProperty(a,"peekCallbacks",{configurable:!1,writable:!1,value:[]}),Object.defineProperty(a,"queueMessage",{configurable:!1,writable:!0,value:async({message:e})=>{await this.queueMessage({message:e,queueName:s})}}),Object.defineProperty(a,"dequeueMessage",{configurable:!1,writable:!0,value:async()=>this.dequeueMessage({queueName:s})}),Object.defineProperty(a,"peekMessage",{configurable:!1,writable:!0,value:async()=>this.peekMessage({queueName:s})}),Object.defineProperty(a,"unbind",{configurable:!1,writable:!1,value:()=>{Object.defineProperty(a,"queueMessage",{configurable:!1,writable:!0,value:()=>{log({logger:i,binding:a,text:"unbinded and not queueing messages anymore."})}}),Object.defineProperty(a,"dequeueMessage",{configurable:!1,writable:!0,value:()=>new Promise(()=>{log({logger:i,binding:a,text:"unbinded and not dequeueing messages anymore."})})}),Object.defineProperty(a,"peekMessage",{configurable:!1,writable:!0,value:()=>new Promise(()=>{log({logger:i,binding:a,text:"unbinded and not peeking at messages anymore."})})}),this.unbind({queueName:s})}}),t[s]=a}}),Object.defineProperty(this,"unbind",{configurable:!1,writable:!1,value:({queueName:e})=>{delete t[e]}})}MessageQueue.prototype.queueMessage=function({}){},MessageQueue.prototype.dequeueMessage=function({}){},MessageQueue.prototype.peekMessage=function({}){},MessageQueue.prototype.bind=function({}){},MessageQueue.prototype.unbind=function({}){};function MessageStatus({messageStatusCode:e}){var{code:t,description:s,parent:r}=allMessageStatus.find(t=>t.code===e||t.code===e.toString());this.code=t,this.description=s,this.parent=r?new MessageStatus({messageStatusCode:r.code}):null,Object.defineProperty(this,"match",{configurable:!1,writable:!1,value:({wildcard:t})=>{for(const e of allMessageStatus.filter(t=>t.parent&&t.parent.code===this.code))if(-1<e.description.toLowerCase().indexOf(t))return e;return null}}),Object.defineProperty(this,"root",{configurable:!1,writable:!1,value:()=>{if(null===this.parent)return this;{let t=this.parent,e=null;for(;t;)t=(e=t).parent;return e}}})}MessageStatus.prototype.match=function({}){},MessageStatus.prototype.root=function(){};function MessageStore(){Object.defineProperty(this,"save",{configurable:!1,writable:!1,value:async({})=>{}}),Object.defineProperty(this,"get",{configurable:!1,writable:!1,value:async({})=>{}})}MessageStore.prototype.save=async function({}){},MessageStore.prototype.get=async function({}){};function RecipientAddress({recipientHost:e,recipientPort:i}){Object.defineProperty(this,"recipientHost",{configurable:!1,writable:!1,value:e}),Object.defineProperty(this,"recipientPort",{configurable:!1,writable:!1,value:i})}function SenderAddress({senderHost:e,senderPort:r}){Object.defineProperty(this,"senderHost",{configurable:!1,writable:!1,value:e}),Object.defineProperty(this,"senderPort",{configurable:!1,writable:!1,value:r})}function ServerMessageBus({httpServerResponseMessageBus:s,httpServerRequestMessageBus:e,messageConverter:t}){Object.defineProperty(this,"publish",{configurable:!1,writable:!1,value:async({message:e})=>{await s.publish(t.convertMessageToHttpResponseMessage({message:e}))}}),Object.defineProperty(this,"subscribe",{configurable:!1,writable:!1,value:({callback:s})=>{e.subscribe({callback:async({httpRequestMessage:e})=>{await s(t.convertHttpRequestMessageToMessage({httpRequestMessage:e}))}})}})}ServerMessageBus.prototype.publish=async function({}){},ServerMessageBus.prototype.subscribe=function({}){};function UserSecurity({userId:i}){let s=null,a,u,n=userIdentities[i],o=null;Object.defineProperty(this,"isRegistered",{configurable:!1,writable:!1,value:()=>void 0!==n}),Object.defineProperty(this,"authenticate",{configurable:!1,writable:!1,value:({secret:e,remoteBase64RSAPublickey:t})=>{o=null;var r,e=utils.hashPassphrase(e,n.hashedPassphraseSalt)["hashedPassphrase"];return e===n.hashedPassphrase&&({privateKey:e,publicKey:r}=utils.generatePublicPrivateKeys(e),a=utils.stringToBase64(e),u=utils.stringToBase64(r),s=t||u,{token:o=utils.stringToBase64(utils.getJSONString({userId:i,base64RSAPublicKey:u}))})}}),Object.defineProperty(this,"isAuthorised",{configurable:!1,writable:!1,value:({token:e})=>utils.isBase64String(a)&&utils.isBase64String(u)&&o===e}),Object.defineProperty(this,"register",{configurable:!1,writable:!1,value:({secret:e})=>{var{hashedPassphrase:e,hashedPassphraseSalt:t}=utils.hashPassphrase(e);n={hashedPassphrase:e,hashedPassphraseSalt:t},userIdentities[i]=n,fs.writeFileSync(userIdentitiesStorePath,JSON.stringify(userIdentities),"utf8")}}),Object.defineProperty(this,"unregister",{configurable:!1,writable:!1,value:()=>{delete userIdentities[i],fs.writeFileSync(userIdentitiesStorePath,JSON.stringify(userIdentities),"utf8")}}),Object.defineProperty(this,"getHashedPassphrase",{configurable:!1,writable:!1,value:()=>n.hashedPassphrase}),Object.defineProperty(this,"getUserId",{configurable:!1,writable:!1,value:()=>i}),Object.defineProperty(this,"getBase64PublicKey",{configurable:!1,writable:!1,value:()=>({base64RSAPublicKey:u})}),Object.defineProperty(this,"getPublicKey",{configurable:!1,writable:!1,value:()=>({publicKey:utils.base64ToString(u)})}),Object.defineProperty(this,"getToken",{configurable:!1,writable:!1,value:()=>({token:o})}),Object.defineProperty(this,"encryptObjectToJSON",{configurable:!1,writable:!1,value:({object:e})=>{e=utils.getJSONString(e)||"{}";return utils.encryptToBase64Str(e,utils.base64ToString(s))}}),Object.defineProperty(this,"decryptJSONToObject",{configurable:!1,writable:!1,value:({encryptedJsonStr:e})=>{var t=this.getHashedPassphrase(),r=utils.base64ToString(a);return utils.getJSONObject(utils.decryptFromBase64Str(e,r,t))}})}UserSecurity.prototype.isRegistered=function(){},UserSecurity.prototype.authenticate=function({}){},UserSecurity.prototype.isAuthorised=function({}){},UserSecurity.prototype.register=function({}){},UserSecurity.prototype.unregister=function(){},UserSecurity.prototype.getHashedPassphrase=function(){},UserSecurity.prototype.getUserId=function(){},UserSecurity.prototype.getBase64KeyPair=function(){},UserSecurity.prototype.getKeyPair=function(){},UserSecurity.prototype.getToken=function(){},UserSecurity.prototype.encryptObjectToJSON=function({}){},UserSecurity.prototype.decryptJSONToObject=function({}){};function UserSessions({scopeId:r}){const n={};Object.defineProperty(this,"ensureSession",{configurable:!1,writable:!1,value:({userId:e})=>{var s;return n[e]||(s=createUserSecurity({scopeId:r,userId:e})["userSecurity"],n[e]=s),{userSecurity:n[e]}}})}UserSessions.prototype.ensureSession=function({}){};function HttpClientMessageBus({scopeId:s,httpClientRequestMessageQueueBinding:t,httpClientResponseMessageQueueBinding:g,httpClientStartMessageQueueBinding:e,httpClientStartedMessageQueueBinding:n,httpClientStopMessageQueueBinding:a,timeout:r}){const o=async({callback:e})=>{var s=(await t.dequeueMessage())["message"];await e({message:s}),await o({callback:e})};a.dequeueMessage().then(({message:e})=>{e.scopeId!==s?a.queueMessage({message:e}):(t.unbind(),g.unbind())}),e.dequeueMessage().then(async()=>{n.queueMessage({message:{scopeId:s}}),o({callback:({message:e})=>{const s=e;var{recipientHost:e,recipientPort:t}=s.getRecipientAddress(),n=s.getPath(),a=s.getHeaders(),o=s.getMethod(),i=s.getEncryptedContent();const u=http.request({host:e,port:t,path:n,headers:a,method:o});u.setTimeout(r),u.on("response",async e=>{e.setEncoding("utf8"),e.on("error",e=>console.error(e)),e.body="";for await(const s of e)e.body+=s;await g.queueMessage({message:e})}),u.on("error",e=>console.error(e)),u.end(i)}})})}function HttpClientMessageBusManager({scopeId:s,httpClientStartMessageQueueBinding:t,httpClientStartedMessageQueueBinding:e,httpClientStopMessageQueueBinding:a}){e.peekMessage().then(({message:e})=>{e&&a.queueMessage({message:{scopeId:e.scopeId}}),t.queueMessage({message:{scopeId:s}})})}function HttpClientRequestMessageBus({httpClientRequestMessageQueueBinding:t}){Object.defineProperty(this,"publish",{configurable:!1,writable:!1,value:({httpRequestMessage:e})=>{t.queueMessage({message:e})}})}HttpClientRequestMessageBus.prototype.publish=function({}){};function HttpClientRequestMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function HttpClientResponseMessageBus({httpClientResponseMessageQueueBinding:e}){const p=require("../factory/httpresponsemessage.factory")["createHttpResponseMessage"];Object.defineProperty(this,"subscribe",{configurable:!1,writable:!1,value:({callback:c})=>{e.dequeueMessage().then(async({message:e})=>{var{body:e,statusCode:s,headers:t}=e,{recipienthost:a,recipientport:n,senderhost:r,senderport:o,token:i}=t;await c(p({scopeId:utils.generateGUID(),messageStatusCode:s,Id:null,data:e,recipientHost:a,recipientPort:n,metadata:t,token:i,senderHost:r,senderPort:o})),this.subscribe({callback:c})})}})}HttpClientResponseMessageBus.prototype.subscribe=function({}){};function HttpClientResponseMessageQueueBinding({scopeId:e,messageQueue:n}){n.bind({bindingObj:this,scopeId:e})}function HttpClientStartedMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function HttpClientStartMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function HttpClientStopMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function HttpClientStoppedMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function HttpRequestMessage({message:t}){var{senderHost:e,senderPort:n}=t.getSenderAddress(),{recipientHost:s,recipientPort:r}=t.getRecipientAddress();const{path:a,secret:o,token:i}=t.getMessageMetadata();var{contentType:g,contentLength:p}=t.getContentMetadata();const c={"Content-Type":g.description,"Content-Length":p,secret:o,token:i,senderhost:e,senderport:n,recipienthost:s,recipientport:r};Object.defineProperty(this,"getId",{configurable:!1,writable:!1,value:t.getId}),Object.defineProperty(this,"getEncryptedContent",{configurable:!1,writable:!1,value:t.getEncryptedContent}),Object.defineProperty(this,"getDecryptedContent",{configurable:!1,writable:!1,value:t.getDecryptedContent}),Object.defineProperty(this,"getSenderAddress",{configurable:!1,writable:!1,value:t.getSenderAddress}),Object.defineProperty(this,"getRecipientAddress",{configurable:!1,writable:!1,value:t.getRecipientAddress}),Object.defineProperty(this,"getContentMetadata",{configurable:!1,writable:!1,value:t.getContentMetadata}),Object.defineProperty(this,"getMessageMetadata",{configurable:!1,writable:!1,value:t.getMessageMetadata}),Object.defineProperty(this,"getHeaders",{configurable:!1,writable:!1,value:()=>utils.getJSONObject(utils.getJSONString(c))}),Object.defineProperty(this,"getPath",{configurable:!1,writable:!1,value:()=>a}),Object.defineProperty(this,"getMethod",{configurable:!1,writable:!1,value:()=>"POST"}),Object.defineProperty(this,"getMessageStatus",{configurable:!1,writable:!1,value:()=>{const e=t.getMessageStatus();return e.match({wildcard:"http"})}})}HttpRequestMessage.prototype.getId=function(){},HttpRequestMessage.prototype.getEncryptedContent=function(){},HttpRequestMessage.prototype.getDecryptedContent=function(){},HttpRequestMessage.prototype.getSenderAddress=function(){},HttpRequestMessage.prototype.getRecipientAddress=function(){},HttpRequestMessage.prototype.getContentMetadata=function(){},HttpRequestMessage.prototype.getMessageMetadata=function(){},HttpRequestMessage.prototype.getHeaders=function(){},HttpRequestMessage.prototype.getPath=function(){},HttpRequestMessage.prototype.getMessageStatus=function(){},HttpRequestMessage.prototype.getMethod=function(){};function HttpResponseMessage({message:s}){var{senderHost:e,senderPort:t}=s.getSenderAddress(),{recipientHost:n,recipientPort:o}=s.getRecipientAddress(),a=s.getMessageMetadata()["token"],{contentType:r,contentLength:i}=s.getContentMetadata();const p={"Content-Type":r.description,"Content-Length":i,senderhost:e,senderport:t,recipienthost:n,recipientport:o,token:a};Object.defineProperty(this,"getId",{configurable:!1,writable:!1,value:s.getId}),Object.defineProperty(this,"getEncryptedContent",{configurable:!1,writable:!1,value:s.getEncryptedContent}),Object.defineProperty(this,"getDecryptedContent",{configurable:!1,writable:!1,value:s.getDecryptedContent}),Object.defineProperty(this,"getSenderAddress",{configurable:!1,writable:!1,value:s.getSenderAddress}),Object.defineProperty(this,"getRecipientAddress",{configurable:!1,writable:!1,value:s.getRecipientAddress}),Object.defineProperty(this,"getContentMetadata",{configurable:!1,writable:!1,value:s.getContentMetadata}),Object.defineProperty(this,"getMessageMetadata",{configurable:!1,writable:!1,value:s.getMessageMetadata}),Object.defineProperty(this,"getMessageStatus",{configurable:!1,writable:!1,value:s.getMessageStatus}),Object.defineProperty(this,"getHeaders",{configurable:!1,writable:!1,value:()=>utils.getJSONObject(utils.getJSONString(p))}),Object.defineProperty(this,"getStatusCode",{configurable:!1,writable:!1,value:()=>{const e=s.getMessageStatus();var t=e.match({wildcard:"http"})["code"];return t}}),Object.defineProperty(this,"getStatusMessage",{configurable:!1,writable:!1,value:()=>{const e=s.getMessageStatus();var t=e.match({wildcard:"http"})["description"];return t}})}HttpResponseMessage.prototype.getId=function(){},HttpResponseMessage.prototype.getEncryptedContent=function(){},HttpResponseMessage.prototype.getDecryptedContent=function(){},HttpResponseMessage.prototype.getSenderAddress=function(){},HttpResponseMessage.prototype.getRecipientAddress=function(){},HttpResponseMessage.prototype.getContentMetadata=function(){},HttpResponseMessage.prototype.getMessageMetadata=function(){},HttpResponseMessage.prototype.getHeaders=function(){},HttpResponseMessage.prototype.getMessageStatus=function(){},HttpResponseMessage.prototype.getStatusCode=function(){},HttpResponseMessage.prototype.getStatusMessage=function(){};function HttpServerMessageBus({scopeId:r,httpServerRequestMessageQueueBinding:o,httpServerResponseMessageQueueBinding:a,httpServerStartMessageQueueBinding:e,httpServerStartedMessageQueueBinding:g,httpServerStopMessageQueueBinding:d,httpServerStoppedMessageQueueBinding:u,senderAddress:i,logger:p,timeout:S}){e.dequeueMessage().then(()=>{var{senderHost:e,senderPort:t}=i;const s={host:e,port:t},n=http.createServer();n.on("error",t=>{s.host?dns.lookup(s.host,e=>{e?p.log({date:new Date,context:"HttpServer",text:e.message}):p.log({date:new Date,context:"HttpServer",text:t.message})}):p.log({date:new Date,context:"HttpServer",text:"host not specified"})}),n.on("request",async(e,t)=>{e.setTimeout(S),e.on("error",e=>console.error(e)),e.body="";for await(const n of e)e.body+=n;await o.queueMessage({message:e});const s=(await a.dequeueMessage())["message"];t.writeHead(s.getStatusCode(),s.getStatusMessage(),s.getHeaders()).end(s.getEncryptedContent())}),n.on("listening",()=>{p.log({date:new Date,context:"HttpServer",text:"listening on: "+utils.getJSONString(s)}),g.queueMessage({message:{scopeId:r}})}),n.on("close",()=>{p.log({date:new Date,context:"HttpServer",text:"server was stopped"}),o.unbind(),a.unbind(),u.queueMessage({message:{scopeId:r}})}),d.dequeueMessage().then(()=>{n.close()}),n.listen(s)})}function HttpServerMessageBusManager({scopeId:g,httpServerStartMessageQueueBinding:t,httpServerStartedMessageQueueBinding:e,httpServerStopMessageQueueBinding:a,httpServerStoppedMessageQueueBinding:u}){e.peekMessage().then(({message:e})=>{if(e){const s=e;a.queueMessage({message:{scopeId:s.scopeId}}),u.dequeueMessage().then(({message:e})=>{g!==e.scopeId&&s.scopeId===e.scopeId&&t.queueMessage({message:{scopeId:g}})})}else t.queueMessage({message:{scopeId:g}})})}function HttpServerRequestMessageBus({httpServerRequestMessageQueueBinding:e}){const p=require("../factory/httprequestmessage.factory")["createHttpRequestMessage"];Object.defineProperty(this,"subscribe",{configurable:!1,writable:!1,value:({callback:c})=>{e.dequeueMessage().then(async({message:e})=>{var{headers:e,body:t,path:s}=e;const r=e;let{recipienthost:a,recipientport:i,senderhost:n,senderport:o,token:u}=r;i=isNaN(i)?i:Number(i),o=isNaN(o)?o:Number(o),r.recipientport=i,r.senderport=o,r.path=s;await c(p({scopeId:utils.generateGUID(),messageStatusCode:2,Id:null,data:t,recipientHost:a,recipientPort:i,metadata:r,token:u,senderHost:n,senderPort:o})),this.subscribe({callback:c})})}})}HttpServerRequestMessageBus.prototype.subscribe=function({}){};function HttpServerRequestMessageQueueBinding({scopeId:e,messageQueue:s}){s.bind({bindingObj:this,scopeId:e})}function HttpServerResponseMessageBus({httpServerResponseMessageQueueBinding:s}){Object.defineProperty(this,"publish",{configurable:!1,writable:!1,value:async({httpResponseMessage:e})=>{await s.queueMessage({message:e})}})}HttpServerResponseMessageBus.prototype.publish=async function({}){};function HttpServerResponseMessageQueueBinding({scopeId:e,messageQueue:s}){s.bind({bindingObj:this,scopeId:e})}function HttpServerStartedMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function HttpServerStartMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function HttpServerStopMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function HttpServerStoppedMessageQueueBinding({scopeId:e,messageQueue:i}){i.bind({bindingObj:this,scopeId:e})}function WebSocketConnection({}){}WebSocketConnection.prototype.isOpen=function(){},WebSocketConnection.prototype.send=async function(){},WebSocketConnection.prototype.open=function(){};function WebSocketMessageHandler({}){this.Id=utils.generateGUID()}function WebSocketMessageQueue(){}